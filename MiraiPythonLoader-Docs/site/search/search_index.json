{"config":{"indexing":"full","lang":["en","jp"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Mirai Python Loader \u57fa\u4e8eMirai Conole Loader \u4e0e Mirai-Api-Http \u6253\u9020\u7684Mirai-Python\u63d2\u4ef6\u52a0\u8f7d\u6846\u67b6 \u7279\u6027 \u8f7b\u91cf\u5316\uff0c\u8d44\u6e90\u5f00\u9500\u5c11 \u652f\u6301\u591aBot\u767b\u5f55\uff0c\u6389\u7ebf\u81ea\u52a8\u91cd\u8fde \u5404\u63d2\u4ef6\u95f4\u6587\u4ef6\uff0c\u65e5\u5fd7\uff0c\u914d\u7f6e\uff0c\u6570\u636e\u5e93\u5206\u79bb\uff0c\u65b9\u4fbf\u7edf\u4e00\u7ba1\u7406 \u63d2\u4ef6\u5f00\u53d1\u65b9\u4fbf \u53ea\u9700\u624b\u6572\u4e24\u884c\u4ee3\u7801\u5373\u53ef\u5b8c\u6210\u6700\u7b80\u5355\u7684\u63d2\u4ef6\uff01 \u4f7f\u7528\u5f00\u53d1\u5305\u5728\u9879\u76ee\u4e2d\u751f\u6210\u63d2\u4ef6\u9879\u76ee\u6a21\u677f F:\\\u9879\u76ee\\MyPlugin>python -m mplapi -n MyPlugin \u91cd\u5199PyPlugin\u7c7b\u65b9\u6cd5 async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): bot.send_group_msg(msg.PlainMsg('Hello,World'), source.group) \u652f\u6301","title":"\u4e3b\u9875"},{"location":"#mirai-python-loader","text":"\u57fa\u4e8eMirai Conole Loader \u4e0e Mirai-Api-Http \u6253\u9020\u7684Mirai-Python\u63d2\u4ef6\u52a0\u8f7d\u6846\u67b6","title":"Mirai Python Loader"},{"location":"#_1","text":"\u8f7b\u91cf\u5316\uff0c\u8d44\u6e90\u5f00\u9500\u5c11 \u652f\u6301\u591aBot\u767b\u5f55\uff0c\u6389\u7ebf\u81ea\u52a8\u91cd\u8fde \u5404\u63d2\u4ef6\u95f4\u6587\u4ef6\uff0c\u65e5\u5fd7\uff0c\u914d\u7f6e\uff0c\u6570\u636e\u5e93\u5206\u79bb\uff0c\u65b9\u4fbf\u7edf\u4e00\u7ba1\u7406","title":"\u7279\u6027"},{"location":"#_2","text":"\u53ea\u9700\u624b\u6572\u4e24\u884c\u4ee3\u7801\u5373\u53ef\u5b8c\u6210\u6700\u7b80\u5355\u7684\u63d2\u4ef6\uff01 \u4f7f\u7528\u5f00\u53d1\u5305\u5728\u9879\u76ee\u4e2d\u751f\u6210\u63d2\u4ef6\u9879\u76ee\u6a21\u677f F:\\\u9879\u76ee\\MyPlugin>python -m mplapi -n MyPlugin \u91cd\u5199PyPlugin\u7c7b\u65b9\u6cd5 async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): bot.send_group_msg(msg.PlainMsg('Hello,World'), source.group)","title":"\u63d2\u4ef6\u5f00\u53d1\u65b9\u4fbf"},{"location":"#_3","text":"","title":"\u652f\u6301"},{"location":"developer/base/","text":"Bot\u7c7b Bot\u7c7b\u662f\u4f60\u7684\u63d2\u4ef6\u4e0emirai\uff08qq\uff09\u901a\u4fe1\u7684\u6865\u6881\uff0c\u7531MPL\u5b9e\u4f8b\u5316\u5e76\u4f20\u9012\u5230\u4f60\u7684\u63d2\u4ef6\u4e2d\uff0c\u901a\u8fc7\u5bf9\u8c61\u65b9\u6cd5\u8fdb\u884c\u53d1\u9001\u6d88\u606f\u7b49\u4ea4\u4e92\u64cd\u4f5c PyPlugin\u7c7b plugin\u6a21\u5757\u4e0b\u7684PyPlugin\u7c7b\uff0c\u5c01\u88c5\u4e86MPL\u63d2\u4ef6\u7684\u529f\u80fd\uff0c\u4f60\u9700\u8981\u7ee7\u627fPyPlugin\u7c7b\uff0c\u6765\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6 \u6ce8\u610f\uff0c\u5fc5\u987b\u5728__init__.py\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6\u7c7b \u901a\u8fc7\u91cd\u5199PyPlugin\u7c7b\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u5b9e\u73b0\u63d2\u4ef6\u7684\u529f\u80fd \u5728 version \u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6\u7248\u672c\uff0c\u4f7f\u7528x.y.z\u89c4\u8303 @property def version(self) -> tuple[int, int, int]: return 0,0,1 on_create \u65b9\u6cd5\u5728MPL\u52a0\u8f7d\u4f60\u7684\u63d2\u4ef6\u65f6\u8c03\u7528 def on_create(self): self.get_logger().info('\u5df2\u52a0\u8f7d\u6211\u7684\u63d2\u4ef6\uff01') # \u8f93\u51fa\u65e5\u5fd7\u5230\u63a7\u5236\u53f0 \u6bcf\u5f53\u4e00\u4e2abot\u767b\u5f55\u65f6\uff0c\u90fd\u4f1a\u8c03\u7528\u4e00\u6b21 on_login \u65b9\u6cd5\uff0c\u4f60\u5fc5\u987b\u901a\u8fc7Bot\u5bf9\u8c61\u4e2d\u7684 register_plugin \u65b9\u6cd5\u5728\u8fd9\u4e2abot\u4e2d\u6ce8\u518c\u4f60\u7684\u63d2\u4ef6 async def on_login(self, bot: Bot): bot.register_plugin(self) # \u6ce8\u518c\u4f60\u7684\u63d2\u4ef6\u5230Bot self.get_logger().info(f'\u5728Bot:{bot.bot_qq} \u4e2d\u6ce8\u518c\u4e86\u6211\u7684\u63d2\u4ef6\uff01') \u4e0d\u7ba1bot\u4f55\u79cd\u65b9\u5f0f\u767b\u51fa\uff08\u5305\u62ec\u88ab\u5c01\u7981\uff0c\u5f3a\u5236\u9000\u51famcl\uff09\uff0c\u90fd\u4f1a\u8c03\u7528 on_logout \u65b9\u6cd5 async def on_logout(self, bot: Bot): self.get_logger().info(f'Bot:{bot.bot_qq} \u767b\u51fa\uff01') MPL\u63a5\u6536\u7684\u6d88\u606f\u53d1\u9001\u8005\u53ef\u5206\u4e3a\u4e09\u7c7b group\uff08\u7fa4\u804a\u6d88\u606f\uff09 friend\uff08\u597d\u53cb\u79c1\u804a\u6d88\u606f\uff09 admin\uff08\u63d2\u4ef6\u7ba1\u7406\u5458\u7684\u6d88\u606f\uff09\u63d2\u4ef6\u7ba1\u7406\u5458\u5c06\u5728 Permission \u4e2d\u8bf4\u660e \u901a\u8fc7\u5b9e\u73b0\u4ee5\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u6765\u5b9e\u73b0\u4f60\u7684\u63d2\u4ef6\u529f\u80fd async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u7fa4{source.group} {source.sender}\u53d1\u9001\u7684\u6d88\u606f') async def get_friend_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u597d\u53cb{source.sender}\u53d1\u9001\u7684\u6d88\u606f') async def get_admin_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u7ba1\u7406\u5458{source.sender}\u53d1\u9001\u7684\u6d88\u606f') Msg\u7c7b MPL\u6536\u53d1\u7684\u6240\u6709\u6d88\u606f\uff0c\u90fd\u662fMsg\u7c7b\u7684\u5b50\u7c7b\uff0c\u4ee5\u4e0b\u4ecb\u7ecd\u51e0\u4e2a\u5e38\u89c1\u7684\u5b50\u7c7b PlainMsg(\u6587\u672c\u6d88\u606f) \u8fd9\u662f\u4e00\u4e2a\u6587\u672c\u6d88\u606f\uff0c\u6d88\u606f\u7684\u6587\u672c\u5b58\u653e\u4e8ePlainMsg\u7c7b\u7684text\u5b57\u6bb5\u4e2d \u4f60\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316\u8be5\u7c7b\uff0c\u6765\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6d88\u606f bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 text_msg = msg.PlainMsg('Hello,World') # \u521b\u5efa\u4e00\u4e2aHello World\u6587\u672c\u6d88\u606f bot.send_group_msg(text_msg, group) # \u53d1\u9001\u8be5\u6d88\u606f\u81f3\u7fa4group ImageMsg(\u56fe\u7247\u6d88\u606f) \u8fd9\u662f\u4e00\u4e2a\u56fe\u7247\u6d88\u606f MPL\u652f\u6301\u901a\u8fc7url\u3001base64\u5b57\u7b26\u4e32\u3001\u8def\u5f84\uff08\u76f8\u5bf9\u8def\u5f84\u6307\u5411mcl\u8fd0\u884c\u76ee\u5f55\uff0c\u7edd\u5bf9\u8def\u5f84\u6307\u5411mcl\u8fd0\u884c\u7684\u670d\u52a1\u5668/\u4e3b\u673a\uff0c\u56e0\u6b64\u4e0d\u63a8\u8350\u4f7f\u7528\uff09\u6765\u521b\u5efa\u56fe\u7247\u6d88\u606f \u8bf7\u6ce8\u610f\uff0c\u63a5\u6536\u7684\u56fe\u7247\u6d88\u606f\u53ea\u6709url\u5c5e\u6027 bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 img_msg = msg.ImageMsg('http://image-url', msg.ImageMsg.URL) # \u901a\u8fc7url\u521b\u5efa\u4e00\u4e2a\u56fe\u7247\u6d88\u606f bot.send_group_msg(img_msg, group) # \u53d1\u9001\u8be5\u6d88\u606f\u81f3\u7fa4group MsgChain(\u6d88\u606f\u94fe) \u6d88\u606f\u53ef\u4ee5\u662f\u6587\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u56fe\u7247\uff0c\u6216\u5176\u4ed6\u3002\u5982\u679c\u5f53\u4e00\u4e2a\u6d88\u606f\u65e2\u6709\u6587\u672c\u53c8\u6709\u56fe\u7247\u65f6\uff0c\u5c31\u9700\u8981\u4e00\u4e2a\u8f7d\u4f53\u6765\u5305\u88c5\u8fd9\u4e2a\u6d88\u606f\uff0cMsgChain\u5c31\u8d77\u5230\u4e86\u8fd9\u4e2a\u8f7d\u4f53\u7684\u4f5c\u7528\uff0c\u5b83\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\u6d88\u606f\u96c6\u5408\u3002 \u63a5\u6536\u7684\u6d88\u606f\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u88abMsgChain\u6240\u5305\u88c5\uff0c\u901a\u8fc7\u5176\u4e2d\u7684get\u65b9\u6cd5\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u6d88\u606f message: msg.MsgChain # \u63a5\u6536\u7684\u6d88\u606f text_msg_list = message.get_plain_msg() # \u83b7\u53d6\u6d88\u606f\u94fe\u4e2d\u6240\u6709\u7684\u6587\u672c\u6d88\u606f for text_msg in text_msg_list: # \u904d\u5386\u6240\u6709\u6587\u672c\u6d88\u606f text = text_msg.text self.get_logger().info(f'\u63a5\u6536\u5230\u4e86\u6587\u672c\u6d88\u606f:{text}') bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 chain = msg.MsgChain() # \u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u94fe text_msg = msg.PlainMsg('Hello,World') # \u521b\u5efa\u4e00\u4e2aHello World\u6587\u672c\u6d88\u606f img_msg = msg.ImageMsg('http://image-url', msg.ImageMsg.URL) # \u901a\u8fc7url\u521b\u5efa\u4e00\u4e2a\u56fe\u7247\u6d88\u606f chain.add_msg(text_msg) # \u5c06\u6587\u672c\u6d88\u606f\u6dfb\u52a0\u5230\u6d88\u606f\u94fe\u4e2d chain.add_msg(img_msg) # \u5c06\u56fe\u7247\u6d88\u606f\u6dfb\u52a0\u5230\u6d88\u606f\u94fe\u4e2d bot.send_group_msg(chain, group) # \u53d1\u9001\u8be5\u6d88\u606f\u94fe\u81f3\u7fa4group","title":"\u57fa\u672c\u4f7f\u7528"},{"location":"developer/base/#bot","text":"Bot\u7c7b\u662f\u4f60\u7684\u63d2\u4ef6\u4e0emirai\uff08qq\uff09\u901a\u4fe1\u7684\u6865\u6881\uff0c\u7531MPL\u5b9e\u4f8b\u5316\u5e76\u4f20\u9012\u5230\u4f60\u7684\u63d2\u4ef6\u4e2d\uff0c\u901a\u8fc7\u5bf9\u8c61\u65b9\u6cd5\u8fdb\u884c\u53d1\u9001\u6d88\u606f\u7b49\u4ea4\u4e92\u64cd\u4f5c","title":"Bot\u7c7b"},{"location":"developer/base/#pyplugin","text":"plugin\u6a21\u5757\u4e0b\u7684PyPlugin\u7c7b\uff0c\u5c01\u88c5\u4e86MPL\u63d2\u4ef6\u7684\u529f\u80fd\uff0c\u4f60\u9700\u8981\u7ee7\u627fPyPlugin\u7c7b\uff0c\u6765\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6 \u6ce8\u610f\uff0c\u5fc5\u987b\u5728__init__.py\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6\u7c7b \u901a\u8fc7\u91cd\u5199PyPlugin\u7c7b\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u5b9e\u73b0\u63d2\u4ef6\u7684\u529f\u80fd \u5728 version \u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4f60\u7684\u63d2\u4ef6\u7248\u672c\uff0c\u4f7f\u7528x.y.z\u89c4\u8303 @property def version(self) -> tuple[int, int, int]: return 0,0,1 on_create \u65b9\u6cd5\u5728MPL\u52a0\u8f7d\u4f60\u7684\u63d2\u4ef6\u65f6\u8c03\u7528 def on_create(self): self.get_logger().info('\u5df2\u52a0\u8f7d\u6211\u7684\u63d2\u4ef6\uff01') # \u8f93\u51fa\u65e5\u5fd7\u5230\u63a7\u5236\u53f0 \u6bcf\u5f53\u4e00\u4e2abot\u767b\u5f55\u65f6\uff0c\u90fd\u4f1a\u8c03\u7528\u4e00\u6b21 on_login \u65b9\u6cd5\uff0c\u4f60\u5fc5\u987b\u901a\u8fc7Bot\u5bf9\u8c61\u4e2d\u7684 register_plugin \u65b9\u6cd5\u5728\u8fd9\u4e2abot\u4e2d\u6ce8\u518c\u4f60\u7684\u63d2\u4ef6 async def on_login(self, bot: Bot): bot.register_plugin(self) # \u6ce8\u518c\u4f60\u7684\u63d2\u4ef6\u5230Bot self.get_logger().info(f'\u5728Bot:{bot.bot_qq} \u4e2d\u6ce8\u518c\u4e86\u6211\u7684\u63d2\u4ef6\uff01') \u4e0d\u7ba1bot\u4f55\u79cd\u65b9\u5f0f\u767b\u51fa\uff08\u5305\u62ec\u88ab\u5c01\u7981\uff0c\u5f3a\u5236\u9000\u51famcl\uff09\uff0c\u90fd\u4f1a\u8c03\u7528 on_logout \u65b9\u6cd5 async def on_logout(self, bot: Bot): self.get_logger().info(f'Bot:{bot.bot_qq} \u767b\u51fa\uff01') MPL\u63a5\u6536\u7684\u6d88\u606f\u53d1\u9001\u8005\u53ef\u5206\u4e3a\u4e09\u7c7b group\uff08\u7fa4\u804a\u6d88\u606f\uff09 friend\uff08\u597d\u53cb\u79c1\u804a\u6d88\u606f\uff09 admin\uff08\u63d2\u4ef6\u7ba1\u7406\u5458\u7684\u6d88\u606f\uff09\u63d2\u4ef6\u7ba1\u7406\u5458\u5c06\u5728 Permission \u4e2d\u8bf4\u660e \u901a\u8fc7\u5b9e\u73b0\u4ee5\u4e0b\u4e09\u4e2a\u65b9\u6cd5\u6765\u5b9e\u73b0\u4f60\u7684\u63d2\u4ef6\u529f\u80fd async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u7fa4{source.group} {source.sender}\u53d1\u9001\u7684\u6d88\u606f') async def get_friend_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u597d\u53cb{source.sender}\u53d1\u9001\u7684\u6d88\u606f') async def get_admin_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.get_logger().info(f'\u6536\u5230\u4e86\u6765\u81ea\u7ba1\u7406\u5458{source.sender}\u53d1\u9001\u7684\u6d88\u606f')","title":"PyPlugin\u7c7b"},{"location":"developer/base/#msg","text":"MPL\u6536\u53d1\u7684\u6240\u6709\u6d88\u606f\uff0c\u90fd\u662fMsg\u7c7b\u7684\u5b50\u7c7b\uff0c\u4ee5\u4e0b\u4ecb\u7ecd\u51e0\u4e2a\u5e38\u89c1\u7684\u5b50\u7c7b","title":"Msg\u7c7b"},{"location":"developer/base/#plainmsg","text":"\u8fd9\u662f\u4e00\u4e2a\u6587\u672c\u6d88\u606f\uff0c\u6d88\u606f\u7684\u6587\u672c\u5b58\u653e\u4e8ePlainMsg\u7c7b\u7684text\u5b57\u6bb5\u4e2d \u4f60\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316\u8be5\u7c7b\uff0c\u6765\u521b\u5efa\u4e00\u4e2a\u6587\u672c\u6d88\u606f bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 text_msg = msg.PlainMsg('Hello,World') # \u521b\u5efa\u4e00\u4e2aHello World\u6587\u672c\u6d88\u606f bot.send_group_msg(text_msg, group) # \u53d1\u9001\u8be5\u6d88\u606f\u81f3\u7fa4group","title":"PlainMsg(\u6587\u672c\u6d88\u606f)"},{"location":"developer/base/#imagemsg","text":"\u8fd9\u662f\u4e00\u4e2a\u56fe\u7247\u6d88\u606f MPL\u652f\u6301\u901a\u8fc7url\u3001base64\u5b57\u7b26\u4e32\u3001\u8def\u5f84\uff08\u76f8\u5bf9\u8def\u5f84\u6307\u5411mcl\u8fd0\u884c\u76ee\u5f55\uff0c\u7edd\u5bf9\u8def\u5f84\u6307\u5411mcl\u8fd0\u884c\u7684\u670d\u52a1\u5668/\u4e3b\u673a\uff0c\u56e0\u6b64\u4e0d\u63a8\u8350\u4f7f\u7528\uff09\u6765\u521b\u5efa\u56fe\u7247\u6d88\u606f \u8bf7\u6ce8\u610f\uff0c\u63a5\u6536\u7684\u56fe\u7247\u6d88\u606f\u53ea\u6709url\u5c5e\u6027 bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 img_msg = msg.ImageMsg('http://image-url', msg.ImageMsg.URL) # \u901a\u8fc7url\u521b\u5efa\u4e00\u4e2a\u56fe\u7247\u6d88\u606f bot.send_group_msg(img_msg, group) # \u53d1\u9001\u8be5\u6d88\u606f\u81f3\u7fa4group","title":"ImageMsg(\u56fe\u7247\u6d88\u606f)"},{"location":"developer/base/#msgchain","text":"\u6d88\u606f\u53ef\u4ee5\u662f\u6587\u672c\uff0c\u4e5f\u53ef\u4ee5\u662f\u56fe\u7247\uff0c\u6216\u5176\u4ed6\u3002\u5982\u679c\u5f53\u4e00\u4e2a\u6d88\u606f\u65e2\u6709\u6587\u672c\u53c8\u6709\u56fe\u7247\u65f6\uff0c\u5c31\u9700\u8981\u4e00\u4e2a\u8f7d\u4f53\u6765\u5305\u88c5\u8fd9\u4e2a\u6d88\u606f\uff0cMsgChain\u5c31\u8d77\u5230\u4e86\u8fd9\u4e2a\u8f7d\u4f53\u7684\u4f5c\u7528\uff0c\u5b83\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\u6d88\u606f\u96c6\u5408\u3002 \u63a5\u6536\u7684\u6d88\u606f\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u88abMsgChain\u6240\u5305\u88c5\uff0c\u901a\u8fc7\u5176\u4e2d\u7684get\u65b9\u6cd5\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u6d88\u606f message: msg.MsgChain # \u63a5\u6536\u7684\u6d88\u606f text_msg_list = message.get_plain_msg() # \u83b7\u53d6\u6d88\u606f\u94fe\u4e2d\u6240\u6709\u7684\u6587\u672c\u6d88\u606f for text_msg in text_msg_list: # \u904d\u5386\u6240\u6709\u6587\u672c\u6d88\u606f text = text_msg.text self.get_logger().info(f'\u63a5\u6536\u5230\u4e86\u6587\u672c\u6d88\u606f:{text}') bot:Bot # bot\u4e3aBot\u7c7b\u5bf9\u8c61 chain = msg.MsgChain() # \u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u94fe text_msg = msg.PlainMsg('Hello,World') # \u521b\u5efa\u4e00\u4e2aHello World\u6587\u672c\u6d88\u606f img_msg = msg.ImageMsg('http://image-url', msg.ImageMsg.URL) # \u901a\u8fc7url\u521b\u5efa\u4e00\u4e2a\u56fe\u7247\u6d88\u606f chain.add_msg(text_msg) # \u5c06\u6587\u672c\u6d88\u606f\u6dfb\u52a0\u5230\u6d88\u606f\u94fe\u4e2d chain.add_msg(img_msg) # \u5c06\u56fe\u7247\u6d88\u606f\u6dfb\u52a0\u5230\u6d88\u606f\u94fe\u4e2d bot.send_group_msg(chain, group) # \u53d1\u9001\u8be5\u6d88\u606f\u94fe\u81f3\u7fa4group","title":"MsgChain(\u6d88\u606f\u94fe)"},{"location":"developer/config/","text":"\u63d2\u4ef6\u5f80\u5f80\u9700\u8981\u4fdd\u5b58\u548c\u83b7\u53d6\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u4fe1\u606f MPL\u7edf\u4e00\u7ba1\u7406\u4e86\u6240\u6709\u63d2\u4ef6\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5e76\u5728PyPlugin\u4e2d\u63d0\u4f9b\u4e86\u64cd\u4f5c\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u6cd5 \u83b7\u53d6\u914d\u7f6e\u4fe1\u606f \u4f7f\u7528 PyPlugin \u7c7b\u7684 get_config \u65b9\u6cd5 def get_config(self, conf_name:str = 'plugin') -> dict: pass get_config \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff1a conf_name :\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a \u2018plugin\u2019 \u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\u5bf9\u8c61 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): conf = self.get_config() \u4fdd\u5b58\u914d\u7f6e\u4fe1\u606f \u4f7f\u7528 PyPlugin \u7c7b\u7684 set_config \u65b9\u6cd5 def set_config(self, conf:dict, conf_name:str = 'plugin'): pass set_config \u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff1a conf :\u914d\u7f6e\u4fe1\u606f conf_name :\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a \u2018plugin\u2019 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): conf = self.get_config() # \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6 conf[bot.bot_qq] = bot.login_time # \u66f4\u6539\u4e00\u4e9b\u914d\u7f6e self.set_config(conf) # \u4fdd\u5b58\u914d\u7f6e \u66f4\u6539\u5b8c\u540e\u8bf7\u4e00\u5b9a\u8981\u4f7f\u7528 set_config \u65b9\u6cd5\u4fdd\u5b58\u4f60\u66f4\u6539\u540e\u7684\u914d\u7f6e \u5426\u5219\u5f53MPL\u91cd\u542f\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u5c06\u4e0d\u4f1a\u88ab\u6539\u53d8","title":"\u914d\u7f6e"},{"location":"developer/config/#_1","text":"\u4f7f\u7528 PyPlugin \u7c7b\u7684 get_config \u65b9\u6cd5 def get_config(self, conf_name:str = 'plugin') -> dict: pass get_config \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff1a conf_name :\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a \u2018plugin\u2019 \u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\u5bf9\u8c61 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): conf = self.get_config()","title":"\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f"},{"location":"developer/config/#_2","text":"\u4f7f\u7528 PyPlugin \u7c7b\u7684 set_config \u65b9\u6cd5 def set_config(self, conf:dict, conf_name:str = 'plugin'): pass set_config \u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff1a conf :\u914d\u7f6e\u4fe1\u606f conf_name :\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a \u2018plugin\u2019 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): conf = self.get_config() # \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6 conf[bot.bot_qq] = bot.login_time # \u66f4\u6539\u4e00\u4e9b\u914d\u7f6e self.set_config(conf) # \u4fdd\u5b58\u914d\u7f6e \u66f4\u6539\u5b8c\u540e\u8bf7\u4e00\u5b9a\u8981\u4f7f\u7528 set_config \u65b9\u6cd5\u4fdd\u5b58\u4f60\u66f4\u6539\u540e\u7684\u914d\u7f6e \u5426\u5219\u5f53MPL\u91cd\u542f\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u5c06\u4e0d\u4f1a\u88ab\u6539\u53d8","title":"\u4fdd\u5b58\u914d\u7f6e\u4fe1\u606f"},{"location":"developer/db/","text":"MPL\u5185\u7f6e\u4e86sqlite\u6570\u636e\u5e93\u4e14\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u5728 PyPlugin \u4e2d\u63d0\u4f9b\u4e86\u8fde\u63a5\u65b9\u6cd5 \u8fde\u63a5\u6570\u636e\u5e93 \u4f7f\u7528 PyPlugin \u7c7b\u7684 get_database \u65b9\u6cd5 def get_database(self, db_name='database') -> sqlite3.Connection: pass get_database \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570 db_name :\u6570\u636e\u5e93\u540d\u79f0\uff0c\u9ed8\u8ba4\u503c 'database' \uff08\u4e0d\u9700\u8981.db\u540e\u7f00\uff09 \u8fd4\u56de sqlite3.Connection \u6570\u636e\u5e93\u8fde\u63a5\u5bf9\u8c61 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): db_conn = self.get_database() cursor = db_conn.cursor() sql = 'CREATE TABLE IF NOT EXISTS user(qq integer PRIMARY KEY, conf text)' cursor.execute(sql) db_conn.commit() db_conn.close() # \u5207\u8bb0\u6700\u540e\u65ad\u5f00\u6570\u636e\u5e93\u8fde\u63a5","title":"\u8fde\u63a5\u6570\u636e\u5e93"},{"location":"developer/db/#_1","text":"\u4f7f\u7528 PyPlugin \u7c7b\u7684 get_database \u65b9\u6cd5 def get_database(self, db_name='database') -> sqlite3.Connection: pass get_database \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570 db_name :\u6570\u636e\u5e93\u540d\u79f0\uff0c\u9ed8\u8ba4\u503c 'database' \uff08\u4e0d\u9700\u8981.db\u540e\u7f00\uff09 \u8fd4\u56de sqlite3.Connection \u6570\u636e\u5e93\u8fde\u63a5\u5bf9\u8c61 class MyPluginClass(PyPlugin): async def on_login(self, bot: Bot): db_conn = self.get_database() cursor = db_conn.cursor() sql = 'CREATE TABLE IF NOT EXISTS user(qq integer PRIMARY KEY, conf text)' cursor.execute(sql) db_conn.commit() db_conn.close() # \u5207\u8bb0\u6700\u540e\u65ad\u5f00\u6570\u636e\u5e93\u8fde\u63a5","title":"\u8fde\u63a5\u6570\u636e\u5e93"},{"location":"developer/exception/","text":"\u5173\u4e8e\u5f02\u6b65\u65b9\u6cd5\u629b\u51fa\u7684\u5f02\u5e38 \u5728 PyPlugin \u548c PluginTask \u4e2d\uff0c\u90fd\u6709\u88ab async \u6807\u8bb0\u7684\u5f02\u6b65\u65b9\u6cd5\uff0c\u4ed6\u4eec\u90fd\u662f\u65e0\u8fd4\u56de\u503c\u7684 \u56e0\u6b64MPL\u5728\u8c03\u7528\u8fd9\u4e9b\u5f02\u6b65\u65b9\u6cd5\u65f6\uff0c\u5e76\u6ca1\u6709\u53bb\u83b7\u53d6\u5b83\u4eec\u7684 Future \u5bf9\u8c61\uff0c\u8fd9\u610f\u5473\u7740\u5f02\u6b65\u65b9\u6cd5\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u4f1a\u88abMPL\u6240\u65e0\u89c6\uff0c\u8fd9\u4e0d\u5229\u4e8e\u63d2\u4ef6\u7684\u8c03\u8bd5\u548c\u540e\u7eed\u7684bug\u4fee\u590d catch_async_exception\u5f02\u6b65\u88c5\u9970\u5668 \u4fdd\u8bc1\u4ee3\u7801\u6ca1\u6709\u5f02\u5e38\uff1f\u975e\u5e38\u56f0\u96be\uff01 try-except \u5927\u6bb5\u4ee3\u7801\uff1f\u4e00\u70b9\u4e5f\u4e0d\u4f18\u96c5\uff01 \u6ca1\u5173\u7cfb\uff0cMPL\u63d0\u4f9b\u4e86 catch_async_exception \u5f02\u6b65\u88c5\u9970\u5668 \u5c06 catch_async_exception \u88c5\u9970\u5230\u5b9e\u73b0\u4e86 PluginExceptionCatcher \u63a5\u53e3\u7684\u7c7b\u5f02\u6b65\u65b9\u6cd5\u4e2d\uff0cMPL\u5c31\u4f1a\u6355\u83b7\u8be5\u65b9\u6cd5\u629b\u51fa\u7684\u5f02\u5e38 PyPlugin \u548c PluginTask \u5747\u5df2\u5b9e\u73b0 PluginExceptionCatcher \u63a5\u53e3 from mplapi.plugin import catch_async_exception # \u5bfc\u5165 class MyPluginClass(PyPlugin): @catch_async_exception # \u88c5\u9970\u5f02\u6b65\u65b9\u6cd5 async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): raise Exception()","title":"\u5f02\u5e38\u6355\u83b7"},{"location":"developer/exception/#_1","text":"\u5728 PyPlugin \u548c PluginTask \u4e2d\uff0c\u90fd\u6709\u88ab async \u6807\u8bb0\u7684\u5f02\u6b65\u65b9\u6cd5\uff0c\u4ed6\u4eec\u90fd\u662f\u65e0\u8fd4\u56de\u503c\u7684 \u56e0\u6b64MPL\u5728\u8c03\u7528\u8fd9\u4e9b\u5f02\u6b65\u65b9\u6cd5\u65f6\uff0c\u5e76\u6ca1\u6709\u53bb\u83b7\u53d6\u5b83\u4eec\u7684 Future \u5bf9\u8c61\uff0c\u8fd9\u610f\u5473\u7740\u5f02\u6b65\u65b9\u6cd5\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u4f1a\u88abMPL\u6240\u65e0\u89c6\uff0c\u8fd9\u4e0d\u5229\u4e8e\u63d2\u4ef6\u7684\u8c03\u8bd5\u548c\u540e\u7eed\u7684bug\u4fee\u590d","title":"\u5173\u4e8e\u5f02\u6b65\u65b9\u6cd5\u629b\u51fa\u7684\u5f02\u5e38"},{"location":"developer/exception/#catch_async_exception","text":"\u4fdd\u8bc1\u4ee3\u7801\u6ca1\u6709\u5f02\u5e38\uff1f\u975e\u5e38\u56f0\u96be\uff01 try-except \u5927\u6bb5\u4ee3\u7801\uff1f\u4e00\u70b9\u4e5f\u4e0d\u4f18\u96c5\uff01 \u6ca1\u5173\u7cfb\uff0cMPL\u63d0\u4f9b\u4e86 catch_async_exception \u5f02\u6b65\u88c5\u9970\u5668 \u5c06 catch_async_exception \u88c5\u9970\u5230\u5b9e\u73b0\u4e86 PluginExceptionCatcher \u63a5\u53e3\u7684\u7c7b\u5f02\u6b65\u65b9\u6cd5\u4e2d\uff0cMPL\u5c31\u4f1a\u6355\u83b7\u8be5\u65b9\u6cd5\u629b\u51fa\u7684\u5f02\u5e38 PyPlugin \u548c PluginTask \u5747\u5df2\u5b9e\u73b0 PluginExceptionCatcher \u63a5\u53e3 from mplapi.plugin import catch_async_exception # \u5bfc\u5165 class MyPluginClass(PyPlugin): @catch_async_exception # \u88c5\u9970\u5f02\u6b65\u65b9\u6cd5 async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): raise Exception()","title":"catch_async_exception\u5f02\u6b65\u88c5\u9970\u5668"},{"location":"developer/file/","text":"MPL\u7edf\u4e00\u7ba1\u7406\u4e86\u6587\u4ef6\u4fdd\u5b58\u7684\u76ee\u5f55\uff0c\u5728 PyPlugin \u4e2d\u63d0\u4f9b\u65b9\u6cd5 \u83b7\u53d6\u6587\u4ef6\u4fdd\u5b58\u76ee\u5f55 \u4f7f\u7528PyPlugin\u7c7b\u7684 get_files_path \u65b9\u6cd5 def get_files_path(self) -> str: pass get_files_path \u65b9\u6cd5\u4e0d\u63a5\u6536\u4efb\u4f55\u53c2\u6570\uff0c\u8fd4\u56de\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84 \uff08\u6700\u540e\u5e26\u5206\u9694\u7b26'/'\uff09 class MyPluginClass(PyPlugin): @catch_async_exception async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): for plain_msg in message.get_plain_msg(): # \u904d\u5386\u6587\u5b57\u6d88\u606f\u5217\u8868 file_path = self.get_files_path() + '\u7fa4\u53cb\u7684\u8bdd.txt' with open(file_path, 'a', encoding='utf-8') as file: file.write(plain_msg.text+'\\n')","title":"\u6587\u4ef6IO"},{"location":"developer/file/#_1","text":"\u4f7f\u7528PyPlugin\u7c7b\u7684 get_files_path \u65b9\u6cd5 def get_files_path(self) -> str: pass get_files_path \u65b9\u6cd5\u4e0d\u63a5\u6536\u4efb\u4f55\u53c2\u6570\uff0c\u8fd4\u56de\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84 \uff08\u6700\u540e\u5e26\u5206\u9694\u7b26'/'\uff09 class MyPluginClass(PyPlugin): @catch_async_exception async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): for plain_msg in message.get_plain_msg(): # \u904d\u5386\u6587\u5b57\u6d88\u606f\u5217\u8868 file_path = self.get_files_path() + '\u7fa4\u53cb\u7684\u8bdd.txt' with open(file_path, 'a', encoding='utf-8') as file: file.write(plain_msg.text+'\\n')","title":"\u83b7\u53d6\u6587\u4ef6\u4fdd\u5b58\u76ee\u5f55"},{"location":"developer/preface/","text":"\u5f00\u53d1\u73af\u5883 Python\u22653.7 \u4f18\u79c0\u7684Python IDE \uff08\u672c\u6587\u6863\u4f7f\u7528PyCharm\u6f14\u793a\uff09 \u6784\u5efa\u63d2\u4ef6\u9879\u76ee \u4f7f\u7528PyCharm\u65b0\u5efa\u9879\u76ee\uff0c\u5728\u9879\u76ee\u4e0b\u6253\u5f00\u7ec8\u7aef \u8f93\u5165 pip install mplapi \u4e0b\u8f7dMPL\u7684\u63d2\u4ef6\u5f00\u53d1\u5305 \u8f93\u5165 python -m mplapi -n \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u751f\u6210\u63d2\u4ef6\u9879\u76ee\u6a21\u677f \u6253\u5f00 \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u76ee\u5f55\u4e0b\u7684 __init__.py \u6587\u4ef6\u5f00\u59cb\u7f16\u5199\u63d2\u4ef6 MPL\u63d2\u4ef6\u9879\u76ee\u7ed3\u6784 \u9879\u76ee\u76ee\u5f55 \u251c\u2500 plugins \u2502 \u251c\u2500 \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u2502 \u2502 \u2514\u2500 __init__.py \u2502 \u2514\u2500 __init__.py","title":"\u51c6\u5907"},{"location":"developer/preface/#_1","text":"Python\u22653.7 \u4f18\u79c0\u7684Python IDE \uff08\u672c\u6587\u6863\u4f7f\u7528PyCharm\u6f14\u793a\uff09","title":"\u5f00\u53d1\u73af\u5883"},{"location":"developer/preface/#_2","text":"\u4f7f\u7528PyCharm\u65b0\u5efa\u9879\u76ee\uff0c\u5728\u9879\u76ee\u4e0b\u6253\u5f00\u7ec8\u7aef \u8f93\u5165 pip install mplapi \u4e0b\u8f7dMPL\u7684\u63d2\u4ef6\u5f00\u53d1\u5305 \u8f93\u5165 python -m mplapi -n \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u751f\u6210\u63d2\u4ef6\u9879\u76ee\u6a21\u677f \u6253\u5f00 \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u76ee\u5f55\u4e0b\u7684 __init__.py \u6587\u4ef6\u5f00\u59cb\u7f16\u5199\u63d2\u4ef6","title":"\u6784\u5efa\u63d2\u4ef6\u9879\u76ee"},{"location":"developer/preface/#mpl","text":"\u9879\u76ee\u76ee\u5f55 \u251c\u2500 plugins \u2502 \u251c\u2500 \u4f60\u7684\u63d2\u4ef6\u540d\u79f0 \u2502 \u2502 \u2514\u2500 __init__.py \u2502 \u2514\u2500 __init__.py","title":"MPL\u63d2\u4ef6\u9879\u76ee\u7ed3\u6784"},{"location":"developer/task/","text":"\u4f7f\u7528\u573a\u666f \u5f53\u4f60\u7684\u63d2\u4ef6\u529f\u80fd\u662f \u89e6\u53d1\u5f0f \u6216\u9700\u8981 \u7ebf\u6027\u4ea4\u4e92 \u65f6\uff0c\u5982\uff1a \u89e6\u53d1\u5f0f\u793a\u4f8b \u8def\u4ebaA\uff1a\u641c\u56fe Bot\uff1a\u8bf7\u572830s\u5185\u53d1\u9001\u4f60\u8981\u641c\u7d22\u7684\u56fe\u7247 \u8def\u4ebaA\uff1a[\u6da9\u56fe] Bot\uff1a[\u6da9\u56fe] \u8be5\u56fe\u51fa\u81ea\u2026\u2026\u2026\u2026 \u7ebf\u6027\u4ea4\u4e92\u793a\u4f8b \u8def\u4ebaB\uff1a\u767e\u5ea6\u767e\u79d1 \u521d\u97f3 Bot\uff1a\u521d\u97f3'\u7684\u641c\u7d22\u7ed3\u679c\u975e\u552f\u4e00\uff0c\u8bf7\u9009\u62e9\uff1a1.\u521d\u97f3\u672a\u6765 2.\u6e38\u620f\u300a\u516c\u4e3b\u8fde\u7ed3\u300b\u4e2d\u7684\u89d2\u8272 \u8def\u4ebaB\uff1a2 Bot\uff1a\u4ee5\u4e0b\u662f'\u521d\u97f3'\u7684\u767e\u79d1\u2026\u2026\u2026\u2026 \u5982\u679c\u5728 get_group_msg \u65b9\u6cd5\u4e2d\u5b9a\u4e49\u6240\u6709\u903b\u8f91\uff0c\u5c06\u4f1a\u6d89\u53ca\u5404\u79cd\u5224\u65ad\u3001\u5d4c\u5957\u3001\u53d8\u91cf\u4fdd\u5b58\u7b49\u3002\u4f1a\u4f7f\u4ee3\u7801\u4e0d\u6613\u8bfb\u61c2\uff0c\u903b\u8f91\u6df7\u4e71 \u56e0\u6b64\uff0cMPL\u63d0\u4f9b\u4e86 PluginTask \u6765\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898 \u8ba4\u8bc6PluginTask PluginTask\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4f60\u9700\u8981\u5b9e\u73b0\u5176\u62bd\u8c61\u65b9\u6cd5 \u81ea\u5b9a\u4e49PluginTask from mplapi.plugin import PluginTask # \u5bfc\u5165 class MyTask(PluginTask): def __init__(self, plugin: PyPlugin): super().__init__(plugin) # PluginTask\u6ca1\u6709\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\uff0c\u4f60\u5fc5\u987b\u8c03\u7528\u5176\u8d85\u7c7b\u6784\u9020\u65b9\u6cd5 # \u4efb\u52a1\u7684\u6267\u884c\u4f53 async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u4efb\u52a1\u6267\u884c\uff01') # \u4efb\u52a1\u8d85\u65f6\u65f6\u8c03\u7528 async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u4efb\u52a1\u8d85\u65f6\uff01') # \u5224\u65ad\u662f\u5426\u662f\u8be5\u4efb\u52a1\u7684\u6267\u884c\u5bf9\u8c61 def is_task_target(self, group, target) -> bool: pass \u5b9e\u4f8b\u5316 class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): task = MyTask(self) # \u4f20\u5165PyPlugin\u5bf9\u8c61\u8fdb\u884c\u5b9e\u4f8b\u5316 MPL\u4e5f\u5185\u7f6e\u4e86\u4e24\u4e2aPluginTask\u7684\u5b50\u7c7b GroupTask \uff08\u7fa4\u4efb\u52a1\uff09 FriendTask \uff08\u597d\u53cb\u4efb\u52a1\uff09 \u5b83\u4eec\u90fd\u5df2\u7ecf\u5b9e\u73b0\u4e86 is_task_target \u65b9\u6cd5 \u81ea\u5b9a\u4e49GroupTask\u3001FriendTask from mplapi.plugin import FriendTask from mplapi.plugin import GroupTask # \u5bfc\u5165 class MyGroupTask(GroupTask): async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u7fa4\u4efb\u52a1\u6267\u884c\uff01') async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u7fa4\u4efb\u52a1\u8d85\u65f6\uff01') class MyFriendTask(FriendTask): async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u597d\u53cb\u4efb\u52a1\u6267\u884c\uff01') async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u597d\u53cb\u4efb\u52a1\u8d85\u65f6\uff01') \u5b9e\u4f8b\u5316 class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): group: int # \u6267\u884c\u4efb\u52a1\u7684\u7fa4\u53f7 target: int # \u6267\u884c\u4efb\u52a1\u7684\u76ee\u6807qq\u53f7 group_task = MyGroupTask(group, self, target) friend_task = MyFriendTask(target, self) \u5176\u4e2dGroupTask\u5b9e\u4f8b\u5316\u65f6\uff0ctarget\u53c2\u6570\u4e0d\u662f\u5fc5\u987b\uff0c\u4e0d\u4f20\u5165\u65f6\u610f\u5473\u7740\u8be5\u7fa4\u5185\u7684\u4efb\u610f\u6210\u5458\u90fd\u53ef\u4ee5\u89e6\u53d1\u6b64\u4efb\u52a1 \u63d0\u4ea4PluginTask \u663e\u7136\uff0c\u4ec5\u4ec5\u5b9e\u4f8b\u5316\u4e00\u4e2aPluginTask\u5bf9\u8c61\u662f\u6ca1\u6709\u4efb\u4f55\u7528\u5904\u7684\uff0c\u4f60\u9700\u8981\u5c06\u5176\u63d0\u4ea4\u81f3Bot\uff0c\u7531Bot\u5bf9\u8c61\u5224\u65ad\u662f\u5426\u6267\u884c \u63d0\u4ea4\u81f3Bot class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): task = MyTask(self) task.set_timeout(30) # \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f430s bot.add_plugin_task(task) \u4e00\u4e2aPluginTask\u5bf9\u8c61\uff0c\u5728\u6267\u884c\u540e\u6216\u8d85\u65f6\u540e\u4f1a\u88abMPL\u6240\u56de\u6536 \u56e0\u6b64\u5728\u63d0\u4ea4\u524d\u5efa\u8bae\u901a\u8fc7 set_timeout \u65b9\u6cd5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u514d\u957f\u65f6\u95f4\u672a\u88ab\u6267\u884c\u5bfc\u81f4\u4efb\u52a1\u5806\u79ef\uff0c\u6d88\u8017\u5185\u5b58\u8d44\u6e90","title":"\u521b\u5efa\u63d2\u4ef6\u4efb\u52a1"},{"location":"developer/task/#_1","text":"\u5f53\u4f60\u7684\u63d2\u4ef6\u529f\u80fd\u662f \u89e6\u53d1\u5f0f \u6216\u9700\u8981 \u7ebf\u6027\u4ea4\u4e92 \u65f6\uff0c\u5982\uff1a","title":"\u4f7f\u7528\u573a\u666f"},{"location":"developer/task/#_2","text":"\u8def\u4ebaA\uff1a\u641c\u56fe Bot\uff1a\u8bf7\u572830s\u5185\u53d1\u9001\u4f60\u8981\u641c\u7d22\u7684\u56fe\u7247 \u8def\u4ebaA\uff1a[\u6da9\u56fe] Bot\uff1a[\u6da9\u56fe] \u8be5\u56fe\u51fa\u81ea\u2026\u2026\u2026\u2026","title":"\u89e6\u53d1\u5f0f\u793a\u4f8b"},{"location":"developer/task/#_3","text":"\u8def\u4ebaB\uff1a\u767e\u5ea6\u767e\u79d1 \u521d\u97f3 Bot\uff1a\u521d\u97f3'\u7684\u641c\u7d22\u7ed3\u679c\u975e\u552f\u4e00\uff0c\u8bf7\u9009\u62e9\uff1a1.\u521d\u97f3\u672a\u6765 2.\u6e38\u620f\u300a\u516c\u4e3b\u8fde\u7ed3\u300b\u4e2d\u7684\u89d2\u8272 \u8def\u4ebaB\uff1a2 Bot\uff1a\u4ee5\u4e0b\u662f'\u521d\u97f3'\u7684\u767e\u79d1\u2026\u2026\u2026\u2026 \u5982\u679c\u5728 get_group_msg \u65b9\u6cd5\u4e2d\u5b9a\u4e49\u6240\u6709\u903b\u8f91\uff0c\u5c06\u4f1a\u6d89\u53ca\u5404\u79cd\u5224\u65ad\u3001\u5d4c\u5957\u3001\u53d8\u91cf\u4fdd\u5b58\u7b49\u3002\u4f1a\u4f7f\u4ee3\u7801\u4e0d\u6613\u8bfb\u61c2\uff0c\u903b\u8f91\u6df7\u4e71 \u56e0\u6b64\uff0cMPL\u63d0\u4f9b\u4e86 PluginTask \u6765\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898","title":"\u7ebf\u6027\u4ea4\u4e92\u793a\u4f8b"},{"location":"developer/task/#plugintask","text":"PluginTask\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4f60\u9700\u8981\u5b9e\u73b0\u5176\u62bd\u8c61\u65b9\u6cd5 \u81ea\u5b9a\u4e49PluginTask from mplapi.plugin import PluginTask # \u5bfc\u5165 class MyTask(PluginTask): def __init__(self, plugin: PyPlugin): super().__init__(plugin) # PluginTask\u6ca1\u6709\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\uff0c\u4f60\u5fc5\u987b\u8c03\u7528\u5176\u8d85\u7c7b\u6784\u9020\u65b9\u6cd5 # \u4efb\u52a1\u7684\u6267\u884c\u4f53 async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u4efb\u52a1\u6267\u884c\uff01') # \u4efb\u52a1\u8d85\u65f6\u65f6\u8c03\u7528 async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u4efb\u52a1\u8d85\u65f6\uff01') # \u5224\u65ad\u662f\u5426\u662f\u8be5\u4efb\u52a1\u7684\u6267\u884c\u5bf9\u8c61 def is_task_target(self, group, target) -> bool: pass \u5b9e\u4f8b\u5316 class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): task = MyTask(self) # \u4f20\u5165PyPlugin\u5bf9\u8c61\u8fdb\u884c\u5b9e\u4f8b\u5316 MPL\u4e5f\u5185\u7f6e\u4e86\u4e24\u4e2aPluginTask\u7684\u5b50\u7c7b GroupTask \uff08\u7fa4\u4efb\u52a1\uff09 FriendTask \uff08\u597d\u53cb\u4efb\u52a1\uff09 \u5b83\u4eec\u90fd\u5df2\u7ecf\u5b9e\u73b0\u4e86 is_task_target \u65b9\u6cd5 \u81ea\u5b9a\u4e49GroupTask\u3001FriendTask from mplapi.plugin import FriendTask from mplapi.plugin import GroupTask # \u5bfc\u5165 class MyGroupTask(GroupTask): async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u7fa4\u4efb\u52a1\u6267\u884c\uff01') async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u7fa4\u4efb\u52a1\u8d85\u65f6\uff01') class MyFriendTask(FriendTask): async def execute_task(self, bot: Bot, source: msg.Source, message: msg.MsgChain): self.plugin_instance.get_logger().info('\u597d\u53cb\u4efb\u52a1\u6267\u884c\uff01') async def on_timeout(self, bot: Bot): self.plugin_instance.get_logger().info('\u597d\u53cb\u4efb\u52a1\u8d85\u65f6\uff01') \u5b9e\u4f8b\u5316 class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): group: int # \u6267\u884c\u4efb\u52a1\u7684\u7fa4\u53f7 target: int # \u6267\u884c\u4efb\u52a1\u7684\u76ee\u6807qq\u53f7 group_task = MyGroupTask(group, self, target) friend_task = MyFriendTask(target, self) \u5176\u4e2dGroupTask\u5b9e\u4f8b\u5316\u65f6\uff0ctarget\u53c2\u6570\u4e0d\u662f\u5fc5\u987b\uff0c\u4e0d\u4f20\u5165\u65f6\u610f\u5473\u7740\u8be5\u7fa4\u5185\u7684\u4efb\u610f\u6210\u5458\u90fd\u53ef\u4ee5\u89e6\u53d1\u6b64\u4efb\u52a1","title":"\u8ba4\u8bc6PluginTask"},{"location":"developer/task/#plugintask_1","text":"\u663e\u7136\uff0c\u4ec5\u4ec5\u5b9e\u4f8b\u5316\u4e00\u4e2aPluginTask\u5bf9\u8c61\u662f\u6ca1\u6709\u4efb\u4f55\u7528\u5904\u7684\uff0c\u4f60\u9700\u8981\u5c06\u5176\u63d0\u4ea4\u81f3Bot\uff0c\u7531Bot\u5bf9\u8c61\u5224\u65ad\u662f\u5426\u6267\u884c \u63d0\u4ea4\u81f3Bot class MyPluginClass(PyPlugin): async def get_group_msg(self, bot: Bot, source: msg.Source, message: msg.MsgChain): task = MyTask(self) task.set_timeout(30) # \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f430s bot.add_plugin_task(task) \u4e00\u4e2aPluginTask\u5bf9\u8c61\uff0c\u5728\u6267\u884c\u540e\u6216\u8d85\u65f6\u540e\u4f1a\u88abMPL\u6240\u56de\u6536 \u56e0\u6b64\u5728\u63d0\u4ea4\u524d\u5efa\u8bae\u901a\u8fc7 set_timeout \u65b9\u6cd5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u514d\u957f\u65f6\u95f4\u672a\u88ab\u6267\u884c\u5bfc\u81f4\u4efb\u52a1\u5806\u79ef\uff0c\u6d88\u8017\u5185\u5b58\u8d44\u6e90","title":"\u63d0\u4ea4PluginTask"},{"location":"developer/moudle/plugin-moudle/","text":"","title":"Plugin moudle"},{"location":"user/environment/","text":"MPL \u9700\u8981\u4ee5\u4e0b\u73af\u5883\u652f\u6301\u8fd0\u884c Mirai Console Loader \u4ee5\u4e0b\u7b80\u79f0 mcl mirai-api-http \u4ee5\u4e0b\u7b80\u79f0 mah \u914d\u7f6e mirai-api-http \u5728\u5b89\u88c5\u597dmah\u63d2\u4ef6\u540e\uff0c\u542f\u52a8mcl\uff0c\u627e\u5230mah\u7684\u914d\u7f6e\u6587\u4ef6 setting.yml mah\u7684\u5b98\u65b9\u4ed3\u5e93readme\u4e2d\u6709 setting.yml \u7684\u914d\u7f6e\u6a21\u677f \u5fc5\u987b \u7684\u914d\u7f6e\u9879\u6709\uff1a adapters: - http enableVerify: true singleMode: false \u82e5\u65e0\u81ea\u5b9a\u4e49\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u590d\u5236\u7c98\u8d34\u4ee5\u4e0b\u6a21\u677f adapters: - http enableVerify: true verifyKey: abcd1234efgh # \u8be5\u503c\u4e3a\u9a8c\u8bc1\u7528\u5bc6\u94a5\uff0c\u8bf7\u81ea\u884c\u4fee\u6539 debug: false singleMode: false cacheSize: 4096 adapterSettings: http: host: 0.0.0.0 port: 8081 # \u9047\u7aef\u53e3\u53f7\u5360\u7528\u65f6\uff0c\u8bf7\u4fee\u6539\u8be5\u503c cors: [\"*\"] unreadQueueMaxSize: 100 \u51fa\u73b0\u5982\u4e0b\u5b57\u6837\u65f6\uff0c\u8868\u660emah\u542f\u52a8\u6210\u529f \u82e5\u51fa\u73b0\u5982\u4e0b\u5b57\u6837\uff0c\u8868\u660emah\u7684\u7aef\u53e3\u88ab\u5360\u7528\uff0c\u8bf7\u4fee\u6539\u7aef\u53e3\u53f7\u540e\u91cd\u65b0\u5c1d\u8bd5 \u5b89\u88c5Python \u4ee5windows\u7cfb\u7edf\u4e3a\u4f8b\uff0clinux\u7cfb\u7edf\u57fa\u672c\u81ea\u5e26python \u524d\u5f80 python\u5b98\u7f51 \u4e0b\u8f7dpython\u5e76\u5b89\u88c5 \uff08\u7248\u672c\u22653.7\uff09 [x] Add Python xx to PATH \ud83d\udc48 \u5207\u8bb0 \u5b89\u88c5\u65f6\u6b64\u9879\u8981\u9009\u4e2d\uff08\u9519\u9009\u8bf7\u81ea\u884c\u67e5\u627e\u5c06Python\u6dfb\u52a0\u81f3\u73af\u5883\u53d8\u91cf\u7684\u65b9\u6cd5\uff09 \u6253\u5f00CMD\uff0c\u8f93\u5165 python --version >\u51fa\u73b0\u5982\u4e0b\u7ed3\u679c\u65f6\u8868\u793a\u6210\u529f\uff01 C:\\Users\\user>python --version Python 3.9.6 #\ud83d\udc47\u672a\u6dfb\u52a0\u81f3\u73af\u5883\u53d8\u91cf C:\\Users\\user>python --version 'python' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f \u6216\u6279\u5904\u7406\u6587\u4ef6\u3002","title":"\u73af\u5883\u5b89\u88c5"},{"location":"user/environment/#mirai-api-http","text":"\u5728\u5b89\u88c5\u597dmah\u63d2\u4ef6\u540e\uff0c\u542f\u52a8mcl\uff0c\u627e\u5230mah\u7684\u914d\u7f6e\u6587\u4ef6 setting.yml mah\u7684\u5b98\u65b9\u4ed3\u5e93readme\u4e2d\u6709 setting.yml \u7684\u914d\u7f6e\u6a21\u677f \u5fc5\u987b \u7684\u914d\u7f6e\u9879\u6709\uff1a adapters: - http enableVerify: true singleMode: false \u82e5\u65e0\u81ea\u5b9a\u4e49\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u590d\u5236\u7c98\u8d34\u4ee5\u4e0b\u6a21\u677f adapters: - http enableVerify: true verifyKey: abcd1234efgh # \u8be5\u503c\u4e3a\u9a8c\u8bc1\u7528\u5bc6\u94a5\uff0c\u8bf7\u81ea\u884c\u4fee\u6539 debug: false singleMode: false cacheSize: 4096 adapterSettings: http: host: 0.0.0.0 port: 8081 # \u9047\u7aef\u53e3\u53f7\u5360\u7528\u65f6\uff0c\u8bf7\u4fee\u6539\u8be5\u503c cors: [\"*\"] unreadQueueMaxSize: 100 \u51fa\u73b0\u5982\u4e0b\u5b57\u6837\u65f6\uff0c\u8868\u660emah\u542f\u52a8\u6210\u529f \u82e5\u51fa\u73b0\u5982\u4e0b\u5b57\u6837\uff0c\u8868\u660emah\u7684\u7aef\u53e3\u88ab\u5360\u7528\uff0c\u8bf7\u4fee\u6539\u7aef\u53e3\u53f7\u540e\u91cd\u65b0\u5c1d\u8bd5","title":"\u914d\u7f6e mirai-api-http"},{"location":"user/environment/#python","text":"\u4ee5windows\u7cfb\u7edf\u4e3a\u4f8b\uff0clinux\u7cfb\u7edf\u57fa\u672c\u81ea\u5e26python \u524d\u5f80 python\u5b98\u7f51 \u4e0b\u8f7dpython\u5e76\u5b89\u88c5 \uff08\u7248\u672c\u22653.7\uff09 [x] Add Python xx to PATH \ud83d\udc48 \u5207\u8bb0 \u5b89\u88c5\u65f6\u6b64\u9879\u8981\u9009\u4e2d\uff08\u9519\u9009\u8bf7\u81ea\u884c\u67e5\u627e\u5c06Python\u6dfb\u52a0\u81f3\u73af\u5883\u53d8\u91cf\u7684\u65b9\u6cd5\uff09 \u6253\u5f00CMD\uff0c\u8f93\u5165 python --version >\u51fa\u73b0\u5982\u4e0b\u7ed3\u679c\u65f6\u8868\u793a\u6210\u529f\uff01 C:\\Users\\user>python --version Python 3.9.6 #\ud83d\udc47\u672a\u6dfb\u52a0\u81f3\u73af\u5883\u53d8\u91cf C:\\Users\\user>python --version 'python' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f \u6216\u6279\u5904\u7406\u6587\u4ef6\u3002","title":"\u5b89\u88c5Python"},{"location":"user/plugin/","text":"\u4f7f\u7528git\u5de5\u5177\uff08\u63a8\u8350\uff09 \u5b89\u88c5git \u4ece git\u5b98\u7f51 \u4e0b\u8f7dgit\u5de5\u5177\u5e76\u5b89\u88c5 \u4f7f\u7528git\u4e0b\u8f7d\u63d2\u4ef6 cd\u81f3MPL\u7684\u76ee\u5f55\u4e0b\uff0cWindows\u53ef\u901a\u8fc7\u5728MPL\u76ee\u5f55\u4e0b\u53f3\u51fb\u7a7a\u767d\u5904\u9009\u62e9 Git Bash Here \u6216\u5728\u6b64\u5904\u6253\u5f00cmd \u8f93\u5165 git clone xxxxx/. \u7b49\u5f85\u4e0b\u8f7d\u5b8c\u6210\u5373\u53ef\uff08xxxxx\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u7684\u63d2\u4ef6\u4ed3\u5e93\u5730\u5740\uff09 \u76f4\u63a5\u4e0b\u8f7d\u63d2\u4ef6 \u5c06\u63d2\u4ef6\u6587\u4ef6\u5939\u79fb\u52a8\u5230MPL\u76ee\u5f55\u4e0b\u7684plugins\u6587\u4ef6\u5939\u5185\u5373\u53ef","title":"\u5b89\u88c5\u63d2\u4ef6"},{"location":"user/plugin/#git","text":"","title":"\u4f7f\u7528git\u5de5\u5177\uff08\u63a8\u8350\uff09"},{"location":"user/plugin/#git_1","text":"\u4ece git\u5b98\u7f51 \u4e0b\u8f7dgit\u5de5\u5177\u5e76\u5b89\u88c5","title":"\u5b89\u88c5git"},{"location":"user/plugin/#git_2","text":"cd\u81f3MPL\u7684\u76ee\u5f55\u4e0b\uff0cWindows\u53ef\u901a\u8fc7\u5728MPL\u76ee\u5f55\u4e0b\u53f3\u51fb\u7a7a\u767d\u5904\u9009\u62e9 Git Bash Here \u6216\u5728\u6b64\u5904\u6253\u5f00cmd \u8f93\u5165 git clone xxxxx/. \u7b49\u5f85\u4e0b\u8f7d\u5b8c\u6210\u5373\u53ef\uff08xxxxx\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u7684\u63d2\u4ef6\u4ed3\u5e93\u5730\u5740\uff09","title":"\u4f7f\u7528git\u4e0b\u8f7d\u63d2\u4ef6"},{"location":"user/plugin/#_1","text":"\u5c06\u63d2\u4ef6\u6587\u4ef6\u5939\u79fb\u52a8\u5230MPL\u76ee\u5f55\u4e0b\u7684plugins\u6587\u4ef6\u5939\u5185\u5373\u53ef","title":"\u76f4\u63a5\u4e0b\u8f7d\u63d2\u4ef6"},{"location":"user/use/","text":"\u4e0b\u8f7dMPL \u524d\u5f80 github-release \uff0c\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684MPL \u89e3\u538b\u538b\u7f29\u5305\uff08\u53ef\u4e0emcl\u76ee\u5f55\u5206\u79bb\uff09 \u5f00\u59cb\u4f7f\u7528 \u6253\u5f00MPL\u76ee\u5f55\u4e2d\u7684 data.json \u6587\u4ef6 \u586b\u5199\u914d\u7f6e\uff0c\u4e0emah\u63d2\u4ef6\u7684 setting.yml \u5bf9\u5e94\uff08\u5176\u4e2dKey\u5bf9\u5e94verifyKey\uff0c\u672c\u5730\u8fd0\u884chost\u586b\u5199127.0.0.1\uff0c\u8fdc\u7a0b\u8fd0\u884chost\u586b\u5199mcl\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740\uff0cqq\u662f\u5728mcl\u767b\u5f55\u7684qq\u53f7\uff0c\u591a\u4e2aqq\u53ef\u7528\u82f1\u6587\u9017\u53f7\u9694\u5f00\uff09 \u542f\u52a8 mcl \uff0c\u767b\u5f55bot \u8fd0\u884c start.bat","title":"\u542f\u52a8MPL"},{"location":"user/use/#mpl","text":"\u524d\u5f80 github-release \uff0c\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684MPL \u89e3\u538b\u538b\u7f29\u5305\uff08\u53ef\u4e0emcl\u76ee\u5f55\u5206\u79bb\uff09","title":"\u4e0b\u8f7dMPL"},{"location":"user/use/#_1","text":"\u6253\u5f00MPL\u76ee\u5f55\u4e2d\u7684 data.json \u6587\u4ef6 \u586b\u5199\u914d\u7f6e\uff0c\u4e0emah\u63d2\u4ef6\u7684 setting.yml \u5bf9\u5e94\uff08\u5176\u4e2dKey\u5bf9\u5e94verifyKey\uff0c\u672c\u5730\u8fd0\u884chost\u586b\u5199127.0.0.1\uff0c\u8fdc\u7a0b\u8fd0\u884chost\u586b\u5199mcl\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740\uff0cqq\u662f\u5728mcl\u767b\u5f55\u7684qq\u53f7\uff0c\u591a\u4e2aqq\u53ef\u7528\u82f1\u6587\u9017\u53f7\u9694\u5f00\uff09 \u542f\u52a8 mcl \uff0c\u767b\u5f55bot \u8fd0\u884c start.bat","title":"\u5f00\u59cb\u4f7f\u7528"}]}